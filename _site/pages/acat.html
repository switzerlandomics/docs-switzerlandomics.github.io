<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#edbe7a"><link rel="shortcut icon" href="/favicon.ico"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/browserconfig.xml"><meta name="theme-color" content="#ffffff"><title>ACAT | Dev docs</title><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="ACAT" /><meta property="og:locale" content="en_US" /><meta name="description" content="Dev docs made with Jeykll using the Just the Docs theme." /><meta property="og:description" content="Dev docs made with Jeykll using the Just the Docs theme." /><link rel="canonical" href="http://localhost:4000/pages/acat.html" /><meta property="og:url" content="http://localhost:4000/pages/acat.html" /><meta property="og:site_name" content="Dev docs" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ACAT" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Dev docs made with Jeykll using the Just the Docs theme.","headline":"ACAT","url":"http://localhost:4000/pages/acat.html"}</script> <script type="text/javascript" defer src="/assets/js/mathjax-script-type.js"> </script> <script type="text/javascript" id="MathJax-script" defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"> </script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/" class="site-title lh-tight"> Dev docs </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="/pages/bam2fastq.html" class="nav-list-link">BWA</a><li class="nav-list-item"><a href="/pages/bayesian_example1.html" class="nav-list-link">Bayes 1 probability in placenta previa</a><li class="nav-list-item"><a href="/pages/bayesian_example2.html" class="nav-list-link">Bayesian 2 probability in placenta previa</a><li class="nav-list-item"><a href="/pages/bayesian_genetic_carrier.html" class="nav-list-link">Bayesian discrete probability example in genetics</a><li class="nav-list-item"><a href="/pages/bayesian_mcmc_samplers.html" class="nav-list-link">Bayes MCMC samplers</a><li class="nav-list-item"><a href="/pages/bayesian_multiparameter_bioassay.html" class="nav-list-link">Bayes multiparameter bioassay demo</a><li class="nav-list-item"><a href="/pages/bayesian_multiparameter_models.html" class="nav-list-link">Bayes multiparameter models</a><li class="nav-list-item"><a href="/pages/benchmark_pipelines.html" class="nav-list-link">Benchmarking pipeline output</a><li class="nav-list-item"><a href="/pages/bevimed.html" class="nav-list-link">BeviMed</a><li class="nav-list-item"><a href="/pages/biomedit.html" class="nav-list-link">BioMedIT</a><li class="nav-list-item"><a href="/pages/bookmarks.html" class="nav-list-link">Bookmarks</a><li class="nav-list-item"><a href="/pages/bwa.html" class="nav-list-link">BWA</a><li class="nav-list-item"><a href="/pages/causal_inference_stats.html" class="nav-list-link">Causal inference stats</a><li class="nav-list-item"><a href="/pages/causal_inference_whole_game.html" class="nav-list-link">Causal inference mosquito nets</a><li class="nav-list-item"><a href="/pages/data_concepts.html" class="nav-list-link">Data concepts</a><li class="nav-list-item"><a href="/pages/data_stream.html" class="nav-list-link">Data stream</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Design documents category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/pages/design_doc.html" class="nav-list-link">Design documents</a><ul class="nav-list"><li class="nav-list-item "><a href="/pages/design_PCA_SNV_INDEL_V1.html" class="nav-list-link">Design PCA SNV INDEL v1</a><li class="nav-list-item "><a href="/pages/design_dna_snvindel_v1.html" class="nav-list-link">Design DNA SNV INDEL v1</a><li class="nav-list-item "><a href="/pages/design_dna_snvindel_v1_release.html" class="nav-list-link">Design release DNA SNV INDEL v1</a><li class="nav-list-item "><a href="/pages/design_dna_snvindel_v2_release.html" class="nav-list-link">Design release DNA SNV INDEL v2</a><li class="nav-list-item "><a href="/pages/design_qv_snvindel_v1.html" class="nav-list-link">Design QV SNV INDEL v1</a><li class="nav-list-item "><a href="/pages/design_statistical_genomics_v1.html" class="nav-list-link">Design statistical genomics v1</a></ul><li class="nav-list-item"><a href="/pages/dna_annotation.html" class="nav-list-link">DNA annotation</a><li class="nav-list-item"><a href="/pages/dna_interpretation.html" class="nav-list-link">DNA interpretation</a><li class="nav-list-item"><a href="/pages/dna_qc.html" class="nav-list-link">DNA QC</a><li class="nav-list-item"><a href="/pages/docker_singularity.html" class="nav-list-link">Docker with singularity</a><li class="nav-list-item"><a href="/pages/exomiser.html" class="nav-list-link">Exomiser</a><li class="nav-list-item"><a href="/pages/exomiser_phenodigm.html" class="nav-list-link">Exomiser phenodigm</a><li class="nav-list-item"><a href="/pages/fastp.html" class="nav-list-link">FASTP</a><li class="nav-list-item"><a href="/pages/fastq.html" class="nav-list-link">FASTQ format data</a><li class="nav-list-item"><a href="/pages/filter_vcf_bcftools.html" class="nav-list-link">Filter VCF with bcftools</a><li class="nav-list-item"><a href="/pages/financial_management.html" class="nav-list-link">Financial management</a><li class="nav-list-item"><a href="/pages/guru.html" class="nav-list-link">Guru variant interpretation</a><li class="nav-list-item"><a href="/pages/gwas.html" class="nav-list-link">GWAS analysis</a><li class="nav-list-item"><a href="/pages/hpc.html" class="nav-list-link">HPC infrastructure</a><li class="nav-list-item"><a href="/pages/inf_causal_metab_sem.html" class="nav-list-link">Inference of causal metabolite networks</a><li class="nav-list-item"><a href="/pages/layout.html" class="nav-list-link">Layout</a><li class="nav-list-item"><a href="/pages/mathjax.html" class="nav-list-link">MathJax config</a><li class="nav-list-item"><a href="/pages/mbdf_models.html" class="nav-list-link">MBDF models</a><li class="nav-list-item"><a href="/pages/mbdf_supervised.html" class="nav-list-link">MBDF supervised</a><li class="nav-list-item"><a href="/pages/mbdf_unsupervised.html" class="nav-list-link">MBDF unsupervised</a><li class="nav-list-item"><a href="/pages/metadata.html" class="nav-list-link">WGS metadata</a><li class="nav-list-item"><a href="/pages/metrics_bcftoolscounts.html" class="nav-list-link">Metrics Bcftools counts</a><li class="nav-list-item"><a href="/pages/metrics_bcftoolsstats.html" class="nav-list-link">Metrics Bcftools stats</a><li class="nav-list-item"><a href="/pages/metrics_collectwgsmetrics.html" class="nav-list-link">Metrics CollectWgsMetrics</a><li class="nav-list-item"><a href="/pages/multiblock_data_fusion.html" class="nav-list-link">Multiblock data fusion</a><li class="nav-list-item"><a href="/pages/panels_disease.html" class="nav-list-link">Panels disease gene</a><li class="nav-list-item"><a href="/pages/pca_biplot_1kg.html" class="nav-list-link">PCA biplot 1000genomes</a><li class="nav-list-item"><a href="/pages/pca_features.html" class="nav-list-link">PCA features</a><li class="nav-list-item"><a href="/pages/platform_updates.html" class="nav-list-link">Platform updates</a><li class="nav-list-item"><a href="/pages/precision_med.html" class="nav-list-link">Precision Medicine Unit (PMU)</a><li class="nav-list-item"><a href="/pages/present/presentations.html" class="nav-list-link">Presentations</a><li class="nav-list-item"><a href="/pages/read_group.html" class="nav-list-link">Read group</a><li class="nav-list-item"><a href="/pages/ref.html" class="nav-list-link">Reference genome</a><li class="nav-list-item"><a href="/pages/rl_finte_mdp.html" class="nav-list-link">RL finite MDP</a><li class="nav-list-item"><a href="/pages/slurm_manager.html" class="nav-list-link">SLURM monitoring</a><li class="nav-list-item"><a href="/pages/slurm_sbatch.html" class="nav-list-link">SLURM sbatch headers</a><li class="nav-list-item"><a href="/pages/stats_altman_bland_analysis_of_methods.html" class="nav-list-link">Stats Analysis of methods</a><li class="nav-list-item"><a href="/pages/stats_altman_bland_ci_from_p.html" class="nav-list-link">Stats CI from P</a><li class="nav-list-item"><a href="/pages/stats_altman_bland_correlation.html" class="nav-list-link">Stats Correlation, regression and repeated data</a><li class="nav-list-item"><a href="/pages/stats_altman_bland_odds_ratios.html" class="nav-list-link">Stats Odds ratios, SE & CI</a><li class="nav-list-item"><a href="/pages/stats_altman_bland_roc_curve.html" class="nav-list-link">Stats Receiver operating characteristic plots</a><li class="nav-list-item"><a href="/pages/stats_altman_bland_sensitivity_specificity.html" class="nav-list-link">Stats Sensitivity and specificity</a><li class="nav-list-item"><a href="/pages/storage_architecture_plan.html" class="nav-list-link">Storage architecture plan</a><li class="nav-list-item"><a href="/pages/storage_estimates.html" class="nav-list-link">Storage estimates</a><li class="nav-list-item"><a href="/pages/storage_use_sync_and_versioning.html" class="nav-list-link">Storage, usage, and Git practices</a><li class="nav-list-item"><a href="/pages/style.html" class="nav-list-link">Style page guide</a><li class="nav-list-item"><a href="/pages/style_writing.html" class="nav-list-link">Style writing guide</a><li class="nav-list-item"><a href="/pages/sv.html" class="nav-list-link">Structural variation detection</a><li class="nav-list-item"><a href="/pages/synth_data.html" class="nav-list-link">Synthetic data</a><li class="nav-list-item"><a href="/pages/variables.html" class="nav-list-link">Variables</a><li class="nav-list-item"><a href="/pages/Phoenix_Sepsis_Score_logic.html" class="nav-list-link">Sepsis score: Phoenix</a><li class="nav-list-item"><a href="/pages/vcf.html" class="nav-list-link">VCF - Variant Call Format</a><li class="nav-list-item"><a href="/pages/vcf_gvcf.html" class="nav-list-link">VCF and gVCF</a><li class="nav-list-item"><a href="/pages/virtual_panels.html" class="nav-list-link">Virtual gene panels</a><li class="nav-list-item"><a href="/pages/vsat.html" class="nav-list-link">VSAT with SKAT</a><li class="nav-list-item"><a href="/pages/vsat_setID.html" class="nav-list-link">SetID for VSAT</a><li class="nav-list-item"><a href="/pages/variant_concept.html" class="nav-list-link">Variant to RDF concept</a><li class="nav-list-item active"><a href="/pages/acat.html" class="nav-list-link active">ACAT</a><li class="nav-list-item"><a href="/pages/acmg_criteria_table_main.html" class="nav-list-link">ACMG criteria</a><li class="nav-list-item"><a href="/pages/aggregate_multiplex.html" class="nav-list-link">Aggregate multiplexed data</a><li class="nav-list-item"><a href="/pages/annotation_table.html" class="nav-list-link">Annotation table</a><li class="nav-list-item"><a href="/pages/documentation_log.html" class="nav-list-link">Documentation log</a></ul></nav><footer class="site-footer"> Maintained by <a href="https://github.com/DylanLawless">Dylan Lawless</a> for <a href="https://switzerlandomics.ch">SwitzerlandOmics.ch</a>.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Dev docs" aria-label="Search Dev docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://github.com/docs-switzerlandomics.github.io" class="site-button" > Github </a><li class="aux-nav-list-item"> <a href="https://switzerlandomics.ch" class="site-button" > SwitzerlandOmics.ch </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><div id="main-content" class="main-content" role="main"><p>Last update: 20230425</p><h1 id="aggregated-cauchy-association-test-acat"> <a href="#aggregated-cauchy-association-test-acat" class="anchor-heading" aria-labelledby="aggregated-cauchy-association-test-acat"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Aggregated Cauchy Association Test (ACAT)</h1><ul id="markdown-toc"><li><a href="#aggregated-cauchy-association-test-acat" id="markdown-toc-aggregated-cauchy-association-test-acat">Aggregated Cauchy Association Test (ACAT)</a><ul><li><a href="#abbreviations" id="markdown-toc-abbreviations">Abbreviations</a><li><a href="#intro-to-this-topic" id="markdown-toc-intro-to-this-topic">Intro to this topic</a><li><a href="#papers" id="markdown-toc-papers">Papers</a><li><a href="#step-by-step-explanation-of-acatr" id="markdown-toc-step-by-step-explanation-of-acatr">Step-by-step explanation of ACAT.R</a><li><a href="#applying-staar-o-for-multiple-annotation-weights" id="markdown-toc-applying-staar-o-for-multiple-annotation-weights">Applying STAAR-O for multiple annotation weights</a><li><a href="#non-gene-centric-analysis-using-dynamic-windows-with-scang-staar" id="markdown-toc-non-gene-centric-analysis-using-dynamic-windows-with-scang-staar">Non-gene-centric analysis using dynamic windows with SCANG-STAAR</a><li><a href="#multi-weight-annotation-analysis" id="markdown-toc-multi-weight-annotation-analysis">Multi-weight annotation analysis</a><li><a href="#main-equations-for-acat" id="markdown-toc-main-equations-for-acat">Main equations for ACAT</a><li><a href="#tan-and-pi" id="markdown-toc-tan-and-pi">tan and \(\pi\)</a><li><a href="#original-r-code-from-yaowuliu" id="markdown-toc-original-r-code-from-yaowuliu">Original R code from yaowuliu</a><li><a href="#example-exercise" id="markdown-toc-example-exercise">Example exercise</a><ul><li><a href="#key-elements-of-the-r-code" id="markdown-toc-key-elements-of-the-r-code">Key Elements of the R Code:</a></ul><li><a href="#r-code-examples" id="markdown-toc-r-code-examples">R code examples</a></ul></ul><hr /><h2 id="abbreviations"> <a href="#abbreviations" class="anchor-heading" aria-labelledby="abbreviations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Abbreviations</h2><ul><li>ACAT: Aggregated Cauchy Association Test<li>ACAT-V: Aggregated Cauchy Association Test - Variant level<li>ACAT-O: Aggregated Cauchy Association Test - Omnibus<li>SKAT: Sequence Kernel Association Test<li>ARIC: Atherosclerosis Risk in Communities</ul><h2 id="intro-to-this-topic"> <a href="#intro-to-this-topic" class="anchor-heading" aria-labelledby="intro-to-this-topic"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Intro to this topic</h2><p>The Aggregated Cauchy Association Test (ACAT) is a statistical method used for rare-variant association tests (RVATs) in genetic studies. ACAT is designed to aggregate the association signals of multiple rare genetic variants within a genomic region or a gene, while accounting for the directions of the effects of these variants on the phenotype of interest. The ACAT method utilizes a Cauchy distribution, which allows for improved performance in identifying true associations, especially when the directions and magnitudes of variant effects are heterogeneous.</p><p>First, here is a great talk by author of SKAT and other methods:</p><p><a href="https://www.youtube.com/watch?v=URGJIAdRTi0&amp;pp=ygUbU2VxdWVuY2Uga2VybmFsIGFzc29jaWF0aW9u">Watch on YouTube</a> <strong>Dr. Xihong Lin</strong>: <em>Overview of Rare Variant Analysis of Whole Genome Sequencing Association Studies</em>.</p><ul><li>The major part starts at time: <a href="https://youtu.be/URGJIAdRTi0?t=1344">22:30</a><li>and the best is at: <a href="https://youtu.be/URGJIAdRTi0?t=1850">30:50</a> where she describes the aggregated Cauchy association test (ACAT) method for combining multiple annotations (like CADD score, MAF, etc.) to calculate the final P-value.<li>This is their annotation database discussed: <a href="https://favor.genohub.org">https://favor.genohub.org</a></ul><h2 id="papers"> <a href="#papers" class="anchor-heading" aria-labelledby="papers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Papers</h2><ul><li><a href="https://www.sciencedirect.com/science/article/pii/S0002929719300023?via%3Dihub">ACAT paper</a>, Yaowu Liu, et al AJGH 2019.<li><a href="https://www.nature.com/articles/s41588-020-0676-4">Application of STAAR protocol to TOPMed</a>, Xihao Li, et al. NatGen 2020.<li><a href="https://doi.org/10.1038/s41592-022-01640-x">STAAR pipeline methods paper</a>, Zilin Li, et al. NatMethods 2022.<li><a href="https://github.com/xihaoli/STAARpipeline">STAAR pipeline github</a><li>Controlling SKAT function: <a href="https://lawlessgenomics.com/topic/skat#skat-r-package-by-leelabsg">Here’s a summary of the SKAT package functions</a> - which are easier to understand than reading the notation in the SKAT papers. If you read the code you see each new implement is added sequentially and how weights work. Although, the ACAT git repo is independent.<li>ACAT git repo: <a href="https://github.com/yaowuliu/ACAT/blob/master/R/ACAT.R">https://github.com/yaowuliu/ACAT/blob/master/R/ACAT.R</a></ul><h2 id="step-by-step-explanation-of-acatr"> <a href="#step-by-step-explanation-of-acatr" class="anchor-heading" aria-labelledby="step-by-step-explanation-of-acatr"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step-by-step explanation of ACAT.R</h2><p>This discussion refers to code in the main ACAT function found at <a href="https://github.com/yaowuliu/ACAT">https://github.com/yaowuliu/ACAT</a>.</p><p><img src="/assets/images/acat/acat_fig_1.jpg" width="80%" /></p><p><strong>Figure 1.</strong> Summary of the Proposed Methods ACAT, ACAT-V, and ACAT-O and the Relationship Among Them. From the ACAT paper</p><ol><li>The R code defines several functions to perform the Aggregated Cauchy Association Test (ACAT) and the ACAT-V test.<ul><li><code class="language-plaintext highlighter-rouge">ACAT</code>: This function combines p-values using the Cauchy distribution.<li><code class="language-plaintext highlighter-rouge">ACAT_V</code>: A set-based test that uses ACAT to combine the variant-level p-values.<li><code class="language-plaintext highlighter-rouge">NULL_Model</code>: Computes model parameters and residuals for ACAT-V.<li><code class="language-plaintext highlighter-rouge">Get.marginal.pval</code>: A helper function to calculate the marginal p-values for ACAT-V.</ul><li><code class="language-plaintext highlighter-rouge">ACAT</code> function<ul><li>a. It accepts <code class="language-plaintext highlighter-rouge">Pvals</code> (p-values), <code class="language-plaintext highlighter-rouge">weights</code>, and an optional <code class="language-plaintext highlighter-rouge">is.check parameter</code> to validate the input.<li>b. Checks for NA, p-value range (0 to 1), and existence of both 0 and 1 p-values in the same column.<li>c. If weights are not provided, equal weights are used. Otherwise, user-supplied weights are validated and standardized.<li>d. The function calculates the Cauchy statistics and returns the ACAT p-value(s).</ul><li><code class="language-plaintext highlighter-rouge">ACAT_V</code> function<ul><li>a. It accepts <code class="language-plaintext highlighter-rouge">G</code> (genotype matrix), <code class="language-plaintext highlighter-rouge">obj</code> (output object of <code class="language-plaintext highlighter-rouge">NULL_Model</code>), <code class="language-plaintext highlighter-rouge">weights.beta</code>, <code class="language-plaintext highlighter-rouge">weights</code>, and <code class="language-plaintext highlighter-rouge">mac.thresh</code>.<li>b. It checks for the validity of input weights.<li>c. Based on the <code class="language-plaintext highlighter-rouge">mac.thresh</code> value, it decides to use the Burden test, the Cauchy method, or a combination of both.<li>d. It calculates the final p-value and returns it.</ul><li><code class="language-plaintext highlighter-rouge">NULL_Model</code> function<ul><li>a. It accepts <code class="language-plaintext highlighter-rouge">Y</code> (outcome phenotypes) and <code class="language-plaintext highlighter-rouge">Z</code> (covariates).<li>b. It determines if <code class="language-plaintext highlighter-rouge">Y</code> is continuous or binary.<li>c. It fits a linear regression model if <code class="language-plaintext highlighter-rouge">Y</code> is continuous and a logistic model if <code class="language-plaintext highlighter-rouge">Y</code> is binary.<li>d. It returns an object with model parameters and residuals.</ul><li><code class="language-plaintext highlighter-rouge">Get.marginal.pval</code> function<ul><li>a. It accepts <code class="language-plaintext highlighter-rouge">G</code> (genotype matrix) and <code class="language-plaintext highlighter-rouge">obj</code> (output object of <code class="language-plaintext highlighter-rouge">NULL_Model</code>).<li>b. It checks the validity of the <code class="language-plaintext highlighter-rouge">obj</code> input.<li>c. It calculates the marginal p-values and returns them.</ul></ol><p>The Aggregated Cauchy Association Test (ACAT) is a powerful and computationally efficient method designed to improve the analysis of rare and low-frequency genetic variants in sequencing studies. Traditional set-based tests can experience power loss when only a small proportion of variants are causal, and their power can be sensitive to factors such as the number, effect sizes, and effect directions of causal variants, as well as weight choices.</p><p>ACAT addresses these issues by combining variant-level p-values to create a set-based test called ACAT-V. ACAT-V is particularly powerful when there are only a few causal variants in a set, making it a valuable tool for genetic analysis. Additionally, ACAT can be used to create an omnibus test called ACAT-O by combining different variant-set-level p-values. ACAT-O incorporates the strengths of multiple complementary set-based tests, such as the burden test, sequence kernel association test (SKAT), and ACAT-V.</p><p>By analyzing extensive simulated data and real-world data from the Atherosclerosis Risk in Communities (ARIC) study, it has been demonstrated that ACAT-V complements other tests like SKAT and the burden test. Furthermore, ACAT-O consistently delivers more robust and higher power than alternative tests, making it a valuable addition to the toolkit of researchers working with sequencing studies.</p><p>ACAT is designed to combine p-values from multiple variants or tests rather than combining annotation scores directly. If you have p-values associated with each of the 5 annotation columns (CADD_score, MAF, GnomAD_AF, REVEL_score, ClinVar_score) for a single variant, you could potentially use ACAT to combine these p-values to obtain a single combined p-value for that variant. However, it’s essential to ensure that the p-values are valid and independent for ACAT to be effective.</p><p>To do this see the STAAR framework for this.</p><p><img src="/assets/images/acat/acat_fig_2.png" width="80%" /></p><p><strong>Figure 2.</strong> Slide from presentation of ACAT method.</p><h2 id="applying-staar-o-for-multiple-annotation-weights"> <a href="#applying-staar-o-for-multiple-annotation-weights" class="anchor-heading" aria-labelledby="applying-staar-o-for-multiple-annotation-weights"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Applying STAAR-O for multiple annotation weights</h2><p>In a separate page, I discuss the STAAR method. The following passages are included in both pages since they related.</p><p>In the STAAR Nature Methods paper, the section <em>Gene-centric analysis of the noncoding genome</em> shows how the STAAR method can indeed be used to capitalize on the ACAT method to obtain a combined p-value from a set of annotations for a single variant. The STAAR framework incorporates multiple functional annotation scores into the RVATs (rare-variant association tests) to increase the power of association analysis. In this context, it uses the STAAR-O test, an omnibus test that aggregates annotation-weighted burden test, SKAT, and ACAT-V within the STAAR framework.</p><p>By incorporating multiple functional annotation scores, such as CADD, LINSIGHT, FATHMM-XF, and annotation principal components (aPCs), the STAAR method enhances the ability to detect associations between variants and traits of interest. Therefore, the STAAR framework can be used to leverage the strengths of the ACAT method and obtain a combined p-value from a set of annotations for a single variant or a set of variants.</p><h2 id="non-gene-centric-analysis-using-dynamic-windows-with-scang-staar"> <a href="#non-gene-centric-analysis-using-dynamic-windows-with-scang-staar" class="anchor-heading" aria-labelledby="non-gene-centric-analysis-using-dynamic-windows-with-scang-staar"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Non-gene-centric analysis using dynamic windows with SCANG-STAAR</h2><p>The SCANG-STAAR method is an improvement over the fixed-size sliding window RVAT in the STAAR framework. It proposes a dynamic window-based approach called SCANG-STAAR, which extends the SCANG procedure by incorporating multidimensional functional annotations. This method allows for flexible detection of locations and sizes of signal windows across the genome, as the locations of regions associated with a disease or trait are often unknown in advance, and their sizes may vary across the genome. Using a prespecified fixed-size sliding window for RVAT can lead to power loss if the prespecified window sizes do not align with the true locations of the signals.</p><p>The SCANG-STAAR method has two main procedures: SCANG-STAAR-S and SCANG-STAAR-B. SCANG-STAAR-S extends the SCANG-SKAT (SCANG-S) procedure by calculating the STAAR-SKAT (STAAR-S) p-value in each overlapping window by incorporating multiple variant functional annotations, instead of using just the MAF-weight-based SKAT p-value. SCANG-STAAR-B is based on the STAAR-Burden p-value. SCANG-STAAR-S has two advantages over SCANG-STAAR-B in detecting noncoding associations using dynamic windows: first, the effects of causal variants in a neighborhood in the noncoding genome tend to be in different directions, especially in intergenic regions; second, due to the different correlation structures of the two test statistics for overlapping windows, the genome-wide significance threshold of SCANG-STAAR-B is lower than that of SCANG-STAAR-S.</p><p>SCANG-STAAR also provides the SCANG-STAAR-O procedure, based on an omnibus p-value of SCANG-STAAR-S and SCANG-STAAR-B calculated by the ACAT method. However, unlike STAAR-O, the ACAT-V test is not incorporated into the omnibus test because it is designed for sparse alternatives, and as a result, it tends to detect the region with the smallest size that contains the most significant variant in the dynamic window procedure.</p><p><img src="/assets/images/acat/acat_fig_3.png" width="80%" /></p><p><strong>Figure 3.</strong> Slide from presentation of ACAT application in STAAR.</p><h2 id="multi-weight-annotation-analysis"> <a href="#multi-weight-annotation-analysis" class="anchor-heading" aria-labelledby="multi-weight-annotation-analysis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multi-weight annotation analysis</h2><p>The STAAR framework can be used to combine the p-values associated with each of the 5 annotation columns (CADD_score, MAF, GnomAD_AF, REVEL_score, ClinVar_score) for a single variant. STAAR incorporates multiple functional annotation scores as weights when constructing its statistics, making it suitable for combining p-values from different annotation columns to obtain a single combined p-value for that variant.</p><h2 id="main-equations-for-acat"> <a href="#main-equations-for-acat" class="anchor-heading" aria-labelledby="main-equations-for-acat"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Main equations for ACAT</h2><ol><li>ACAT test statistic:</ol>\[T_{ACAT} = \sum_{i=1}^{k} w_i \tan{[(0.5 - p_i)\pi]}\]<p>where \(p_i\) are the p-values, and \(w_i\) are non-negative weights.</p><ol><li>P-value calculation for the ACAT test statistic:</ol>\[p \text{-value} \approx 1 - \frac{1}{2} + \frac{\arctan{(T_{ACAT} / w)}}{\pi}\]<p>where \(w = \sum_{i=1}^{k} w_i\).</p><ol><li>ACAT is a general and flexible method of combining p-values, which can represent the statistical significance of different kinds of genetic variations in sequencing studies.<li>ACAT only aggregates p-values, so one can automatically control cryptic relatedness and/or population stratification by fitting appropriate models from which p-values are calculated through methods such as principal-component analysis or mixed models.<li>The null distribution of the test statistic \(T_{ACAT}\) can be well approximated by a Cauchy distribution without the need for estimating and accounting for the correlation among p-values.<li>Calculating the p-value of ACAT requires almost negligible computation and is extremely fast.<li>The approximation is particularly accurate when ACAT has a very small p-value, which is useful in sequencing studies because only very small p-values can pass the stringent genome-wide significance threshold and are of particular interest.</ol><h2 id="tan-and-pi"> <a href="#tan-and-pi" class="anchor-heading" aria-labelledby="tan-and-pi"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> tan and \(\pi\)</h2><p>In the ACAT method, the “tan” and “π” functions are used to transform the p-values in such a way that they follow a standard Cauchy distribution under the null hypothesis. This transformation is essential to the ACAT method because it allows for an efficient and accurate combination of p-values, even when they are correlated.</p><p>The reason for using the tangent function (“tan”) specifically is because of its connection to the Cauchy distribution. The Cauchy distribution has some unique properties, such as having a heavy tail, which make it suitable for handling correlated p-values in this context. The transformation function used in the ACAT method, given by \(tan((0.5 - p_i) \pi)\), ensures that if the p-value \(p_i\) is from the null distribution, the transformed value will follow a standard Cauchy distribution.</p><p>The constant \(\pi\) (Pi) is used in the formula because it is a natural component of the tangent function. In the context of the ACAT method, \(\pi\) is used to scale the input of the tangent function, which is necessary to map the range of p-values (0 to 1) to the entire domain of the tangent function. This ensures that the transformed values will follow the desired Cauchy distribution.</p><p>Therefore, the “tan” and \(\pi\) functions in the ACAT method are used to transform p-values so that they follow a standard Cauchy distribution under the null hypothesis, which allows for an efficient and accurate combination of correlated p-values.</p><h2 id="original-r-code-from-yaowuliu"> <a href="#original-r-code-from-yaowuliu" class="anchor-heading" aria-labelledby="original-r-code-from-yaowuliu"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Original R code from yaowuliu</h2><p>This code is the main ACAT function found at <a href="https://github.com/yaowuliu/ACAT">https://github.com/yaowuliu/ACAT</a></p><h2 id="example-exercise"> <a href="#example-exercise" class="anchor-heading" aria-labelledby="example-exercise"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example exercise</h2><p>The following R code demonstrates the use of ACAT on simulation data. This method aggregates multiple rare genetic variant signals within a genomic region or gene, accounting for the heterogeneous directions and magnitudes of variant effects on the phenotype. Additionally, it incorporates GTEx data in simulations to enhance realism and applicability in genetic research.</p><h3 id="key-elements-of-the-r-code"> <a href="#key-elements-of-the-r-code" class="anchor-heading" aria-labelledby="key-elements-of-the-r-code"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Elements of the R Code:</h3><ol><li><p><strong>Loading Necessary Libraries</strong>: The script loads R packages like <code class="language-plaintext highlighter-rouge">ggplot2</code>, <code class="language-plaintext highlighter-rouge">dplyr</code>, <code class="language-plaintext highlighter-rouge">reshape2</code>, and <code class="language-plaintext highlighter-rouge">ACAT</code> for data manipulation, statistical analysis, and visualization.</p><li><p><strong>Simulating Data</strong>: It simulates genetic data, including phenotypes, genotypes, and annotations such as CADD scores, allele frequencies, and pathogenicity scores, setting a realistic backdrop for applying the ACAT method.</p><li><p><strong>Generating P-values with Outliers</strong>: A function <code class="language-plaintext highlighter-rouge">generate_pvalues_with_outliers</code> produces example p-values with intentional outliers, this will be necessary to show ACAT’s ability to handle diverse data distributions.</p><li><p><strong>Data Aggregation and Visualization</strong>: Post-simulation, the script aggregates and visualizes the data, highlighting the distribution of original scores and p-values through histograms and scatter plots.</p><li><p><strong>ACAT Function Application</strong>: At its core, the script applies the ACAT function to the simulated p-values. This function uses the Cauchy distribution to combine p-values across multiple tests or variants, aiding in identifying genuine genetic associations.</p><li><p><strong>Incorporating GTEx Data</strong>: The code uses real data for GTEx gene expression to provide a context for ACAT application, more similar to real-world genetic analysis.</p><li><p><strong>Analysis and interpretation</strong>: The script includes modeling steps with <code class="language-plaintext highlighter-rouge">limma</code>. This is used for gene expression data, especially the use of linear models for analysing designed experiments and the assessment of differential expression.</p></ol><p>This R code example allows us to observe the ACAT method’s with simple data. The visual outputs illustrate the impact of different data distributions on ACAT results, demonstrating its effectiveness in genetic association studies, especially those focusing on rare variants.</p><h2 id="r-code-examples"> <a href="#r-code-examples" class="anchor-heading" aria-labelledby="r-code-examples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> R code examples</h2><div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Loading necessary libraries</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ACAT</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">EnhancedVolcano</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gridExtra</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">limma</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">

</span><span class="c1"># library(devtools)</span><span class="w">
</span><span class="c1"># devtools::install_github("yaowuliu/ACAT")</span><span class="w">
</span><span class="c1"># if (!requireNamespace('BiocManager', quietly = TRUE))</span><span class="w">
	</span><span class="c1"># install.packages('BiocManager')</span><span class="w">
</span><span class="c1"># BiocManager::install('limma')</span><span class="w">

</span><span class="c1"># Set up example test data ----</span><span class="w">
</span><span class="c1"># Set seed for reproducibility</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">

</span><span class="c1"># Number of variants</span><span class="w">
</span><span class="n">n_variants</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">50</span><span class="w">

</span><span class="c1"># Simulate Associated Variables</span><span class="w">
</span><span class="n">CADD_score</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">n_variants</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w">  </span><span class="c1"># Score can be any value</span><span class="w">
</span><span class="n">allele_frequency</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">n_variants</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">  </span><span class="c1"># Score can be any value</span><span class="w">
</span><span class="n">pathogenicity</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">n_variants</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">  </span><span class="c1"># Score can be any value</span><span class="w">

</span><span class="c1"># Simulate P-values with a few outliers</span><span class="w">
</span><span class="n">generate_pvalues_with_outliers</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">outlier_indices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="n">p_values</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
	</span><span class="c1"># Assigning very small values to selected outliers</span><span class="w">
	</span><span class="n">p_values</span><span class="p">[</span><span class="n">outlier_indices</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">outlier_indices</span><span class="p">),</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.001</span><span class="p">)</span><span class="w">
	</span><span class="nf">return</span><span class="p">(</span><span class="n">p_values</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Indices of potential outliers</span><span class="w">
</span><span class="n">outlier_indices</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n_variants</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">  </span><span class="c1"># Randomly select 2 variants to be outliers</span><span class="w">

</span><span class="c1"># Generate P-values</span><span class="w">
</span><span class="n">CADD_score_pval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">generate_pvalues_with_outliers</span><span class="p">(</span><span class="n">n_variants</span><span class="p">,</span><span class="w"> </span><span class="n">outlier_indices</span><span class="p">)</span><span class="w">
</span><span class="n">allele_frequency_pval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">generate_pvalues_with_outliers</span><span class="p">(</span><span class="n">n_variants</span><span class="p">,</span><span class="w"> </span><span class="n">outlier_indices</span><span class="p">)</span><span class="w">
</span><span class="n">pathogenicity_pval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">generate_pvalues_with_outliers</span><span class="p">(</span><span class="n">n_variants</span><span class="p">,</span><span class="w"> </span><span class="n">outlier_indices</span><span class="p">)</span><span class="w">

</span><span class="c1"># Combine variables into a single dataframe for visualization</span><span class="w">
</span><span class="n">variant_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
	</span><span class="n">variant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n_variants</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w">
	</span><span class="n">measure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="w">
		</span><span class="s2">"CADD_score"</span><span class="p">,</span><span class="w"> </span><span class="s2">"allele_frequency"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pathogenicity"</span><span class="w">
	</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_variants</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w">
	</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="w">
		</span><span class="nf">rep</span><span class="p">(</span><span class="s2">"Original Score"</span><span class="p">,</span><span class="w"> </span><span class="n">n_variants</span><span class="p">),</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">"P-Value"</span><span class="p">,</span><span class="w"> </span><span class="n">n_variants</span><span class="p">)</span><span class="w">
	</span><span class="p">),</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w">
	</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w">
		</span><span class="n">CADD_score</span><span class="p">,</span><span class="w">
		</span><span class="n">CADD_score_pval</span><span class="p">,</span><span class="w">
		</span><span class="n">allele_frequency</span><span class="p">,</span><span class="w">
		</span><span class="n">allele_frequency_pval</span><span class="p">,</span><span class="w">
		</span><span class="n">pathogenicity</span><span class="p">,</span><span class="w">
		</span><span class="n">pathogenicity_pval</span><span class="w">
	</span><span class="p">)</span><span class="w">  </span><span class="c1"># Alternating Original Scores and P-values for each measure</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Melt the data for ggplot</span><span class="w">
</span><span class="n">variant_data_melted</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">melt</span><span class="p">(</span><span class="n">variant_data</span><span class="p">,</span><span class="w"> </span><span class="n">id.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'variant'</span><span class="p">,</span><span class="w"> </span><span class="s1">'measure'</span><span class="p">,</span><span class="w"> </span><span class="s1">'type'</span><span class="p">))</span><span class="w">

</span><span class="c1"># Calculate the significance threshold for P-values (not log-transformed)</span><span class="w">
</span><span class="n">significance_threshold</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n_variants</span><span class="w">

</span><span class="c1"># Separate the data into two parts: one for original scores and one for P-values</span><span class="w">
</span><span class="n">original_scores_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">variant_data_melted</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Original Score"</span><span class="p">)</span><span class="w">
</span><span class="n">p_values_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">variant_data_melted</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"P-Value"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot for original scores</span><span class="w">
</span><span class="n">p_original_scores</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">original_scores_data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">variant</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">measure</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_classic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Original Scores"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Values"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Variables"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot for P-values with log scale</span><span class="w">
</span><span class="n">p_p_values</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">p_values_data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="w">
	</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">variant</span><span class="p">,</span><span class="w">
	</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">log10</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="w">
	</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">measure</span><span class="w">
</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_classic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"P-values"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"-log10(P-values)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">log10</span><span class="p">(</span><span class="n">significance_threshold</span><span class="p">)),</span><span class="w">
						 </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dashed"</span><span class="p">,</span><span class="w">
						 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Combine the two plots</span><span class="w">
</span><span class="n">p_combined</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">p_original_scores</span><span class="p">,</span><span class="w"> </span><span class="n">p_p_values</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">p_combined</span><span class="p">)</span><span class="w">

</span><span class="c1"># Save the combined plot (optional)</span><span class="w">
</span><span class="c1"># ggsave("./images/p_combined.png", plot = p_combined) #, width = 8, height = 12)</span><span class="w">
</span></code></pre></div></div><p><img src="/assets/images/acat/p_combined.png" width="80%" /></p><div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1"># ACAT library ----</span><span class="w">
</span><span class="c1"># Assuming variant_data_melted is the dataframe created in your previous code</span><span class="w">
</span><span class="c1"># Filter the data to include only P-values</span><span class="w">
</span><span class="n">p_values_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">variant_data_melted</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">filter</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"P-Value"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">mutate</span><span class="p">(</span><span class="n">log_p_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">log10</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w">

</span><span class="c1"># Plot the histogram of P-values</span><span class="w">
</span><span class="n">p_histogram</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">p_values_data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w">
								 </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w">
								 </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Histogram of P-values for Variants"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"P-values"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Frequency"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Display the histogram</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">p_histogram</span><span class="p">)</span><span class="w">

</span><span class="c1"># QQ-Plot of P-values</span><span class="w">
</span><span class="n">p_qqplot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">p_values_data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_qq</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_qq_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"QQ-Plot of P-values for Variants"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Theoretical Quantiles"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sample Quantiles"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Display the QQ-plot</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">p_qqplot</span><span class="p">)</span><span class="w">

</span><span class="c1"># Combine the two plots</span><span class="w">
</span><span class="n">p_hist_qq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">p_histogram</span><span class="p">,</span><span class="w"> </span><span class="n">p_qqplot</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">p_hist_qq</span><span class="p">)</span><span class="w">
</span><span class="c1"># ggsave("./images/p_hist_qq.png", plot = p_hist_qq)</span><span class="w">
</span></code></pre></div></div><p><img src="/assets/images/acat/p_hist_qq.png" width="80%" /></p><div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">

</span><span class="c1"># Group by variant and apply ACAT</span><span class="w">
</span><span class="n">p_values_per_variant</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p_values_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">group_by</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">summarize</span><span class="p">(</span><span class="n">aggregated_pval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ACAT</span><span class="p">(</span><span class="n">Pvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w">

</span><span class="c1"># Apply ACAT to aggregated P-values for each variant</span><span class="w">
</span><span class="n">acat_results_per_variant</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">p_values_per_variant</span><span class="p">[,</span><span class="w"> </span><span class="m">-1</span><span class="p">],</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span><span class="w"> </span><span class="n">ACAT</span><span class="p">(</span><span class="n">pvals</span><span class="p">))</span><span class="w">

</span><span class="c1"># Prepare data for visualization</span><span class="w">
</span><span class="n">acat_results_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Variant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_values_per_variant</span><span class="o">$</span><span class="n">variant</span><span class="p">,</span><span class="w"> </span><span class="n">ACAT_P_Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acat_results_per_variant</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot ACAT results for each variant</span><span class="w">
</span><span class="n">p_acat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">acat_results_df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Variant</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">log10</span><span class="p">(</span><span class="n">ACAT_P_Value</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ACAT P-values for Each Variant"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"-log10(ACAT P-value)"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Variant"</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">log10</span><span class="p">(</span><span class="n">significance_threshold</span><span class="p">)),</span><span class="w">
						 </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dashed"</span><span class="p">,</span><span class="w">
						 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w">

</span><span class="n">p_acat</span><span class="w">

</span><span class="c1"># ggsave("./images/p_acat.png", plot = p_acat)</span><span class="w">
</span></code></pre></div></div><p><img src="/assets/images/acat/p_acat.png" width="80%" /></p><div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1"># GTEx ----</span><span class="w">

</span><span class="c1"># GTEx_Analysis_2017-06-05_v8_RNASeQCv1.1.9_gene_median_tpm.gct.gz	Median gene-level TPM by tissue. Median expression was calculated from the file GTEx_Analysis_2017-06-05_v8_RNASeQCv1.1.9_gene_tpm.gct.gz.</span><span class="w">
</span><span class="c1"># https://storage.googleapis.com/adult-gtex/bulk-gex/v8/rna-seq/GTEx_Analysis_2017-06-05_v8_RNASeQCv1.1.9_gene_median_tpm.gct.gz</span><span class="w">

</span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="w">
	</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"./data/GTEx_Analysis_2017-06-05_v8_RNASeQCv1.1.9_gene_median_tpm.gct"</span><span class="p">,</span><span class="w">
	</span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\t"</span><span class="p">,</span><span class="w">
	</span><span class="n">comment.char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#"</span><span class="p">,</span><span class="w">
	</span><span class="n">skip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="c1"># Adjust this number based on whether you count the header line or not</span><span class="w">

</span><span class="c1"># Calculate the row means, excluding the first two metadata columns</span><span class="w">
</span><span class="n">tmp</span><span class="o">$</span><span class="n">tissue_mean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rowMeans</span><span class="p">(</span><span class="n">tmp</span><span class="p">[,</span><span class="w"> </span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)])</span><span class="w">

</span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="s2">"Name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Description"</span><span class="p">,</span><span class="w"> </span><span class="s2">"tissue_mean"</span><span class="p">)</span><span class="w">

</span><span class="nf">names</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="w">

</span><span class="c1"># Assuming tmp has been read and tissue_mean calculated as before</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">  </span><span class="c1"># For reproducibility</span><span class="w">

</span><span class="c1"># Standard deviation assumption (modify as needed)</span><span class="w">
</span><span class="n">std_dev_assumption</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">

</span><span class="c1"># Simulating 10 cases and 10 controls for each gene</span><span class="w">
</span><span class="n">n_samples</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w">

</span><span class="c1"># Simulating data using a Poisson distribution</span><span class="w">
</span><span class="c1"># The lambda parameter is the mean for each gene</span><span class="w">
</span><span class="n">tmp</span><span class="o">$</span><span class="n">Cases</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">replicate</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span><span class="w"> </span><span class="n">rpois</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="o">$</span><span class="n">tissue_mean</span><span class="p">))</span><span class="w">
</span><span class="n">tmp</span><span class="o">$</span><span class="n">Controls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">replicate</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span><span class="w"> </span><span class="n">rpois</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="o">$</span><span class="n">tissue_mean</span><span class="p">))</span><span class="w">

</span><span class="c1"># Assuming tmp and n_samples are defined as before</span><span class="w">
</span><span class="c1"># Choose a number of genes to modify</span><span class="w">
</span><span class="n">n_genes_to_modify</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w">

</span><span class="c1"># Randomly select genes</span><span class="w">
</span><span class="n">selected_genes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span><span class="w"> </span><span class="n">n_genes_to_modify</span><span class="p">)</span><span class="w">

</span><span class="c1"># Modify the expression values for these genes</span><span class="w">
</span><span class="c1"># Here, we'll increase the expression values for cases</span><span class="w">
</span><span class="c1"># You can choose a multiplication factor or an additive factor</span><span class="w">
</span><span class="n">modification_factor</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">gene</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">selected_genes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="n">tmp</span><span class="o">$</span><span class="n">Cases</span><span class="p">[</span><span class="n">gene</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp</span><span class="o">$</span><span class="n">Cases</span><span class="p">[</span><span class="n">gene</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">modification_factor</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Reshaping the data for limma analysis</span><span class="w">
</span><span class="n">case_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">tmp</span><span class="o">$</span><span class="n">Cases</span><span class="p">)</span><span class="w">
</span><span class="n">control_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">tmp</span><span class="o">$</span><span class="n">Controls</span><span class="p">)</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">case_data</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"Case"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n_samples</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">control_data</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"Control"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n_samples</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w">
</span><span class="n">combined_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">case_data</span><span class="p">,</span><span class="w"> </span><span class="n">control_data</span><span class="p">)</span><span class="w">

</span><span class="c1"># Reshape combined_data for ggplot</span><span class="w">
</span><span class="n">long_combined_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">melt</span><span class="p">(</span><span class="n">combined_data</span><span class="p">)</span><span class="w">
</span><span class="n">long_combined_data</span><span class="o">$</span><span class="n">group</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"Case"</span><span class="p">,</span><span class="w"> </span><span class="n">long_combined_data</span><span class="o">$</span><span class="n">variable</span><span class="p">),</span><span class="w"> </span><span class="s2">"Case"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Control"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Create the plot</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">long_combined_data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
								 </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
								 </span><span class="n">bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Expression Level"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Frequency"</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Distribution of Simulated Expression Levels"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Case"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Control"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">))</span><span class="w">

</span><span class="c1"># p_gtex_gene_median_tpm_histogram</span><span class="w">

</span><span class="c1"># Creating a design matrix for the differential expression analysis</span><span class="w">
</span><span class="n">group</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="s2">"Case"</span><span class="p">,</span><span class="w"> </span><span class="n">n_samples</span><span class="p">),</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">"Control"</span><span class="p">,</span><span class="w"> </span><span class="n">n_samples</span><span class="p">)))</span><span class="w">
</span><span class="n">design</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">model.matrix</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">group</span><span class="p">)</span><span class="w">

</span><span class="c1"># Applying voom transformation</span><span class="w">
</span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">voom</span><span class="p">(</span><span class="n">combined_data</span><span class="p">,</span><span class="w"> </span><span class="n">design</span><span class="p">)</span><span class="w">

</span><span class="c1"># Fit the linear model</span><span class="w">
</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmFit</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">design</span><span class="p">)</span><span class="w">

</span><span class="c1"># Apply empirical Bayes moderation</span><span class="w">
</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eBayes</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="w">

</span><span class="c1"># Extract differentially expressed genes</span><span class="w">
</span><span class="n">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">topTable</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="w">
</span><span class="c1"># results &lt;- topTable(fit, adjust.method = "bonferroni")</span><span class="w">

</span><span class="n">results</span><span class="w">
</span></code></pre></div></div><div class="table-wrapper"><table><thead><tr><th> <th>logFC<th>AveExpr<th>t<th>P.Value<th>adj.P.Val<th>B<tbody><tr><td>21692<td>-3.140047<td>4.68799<td>-14.06914<td>2.764495e-11<td>0.0000016<td>15.700482<tr><td>43000<td>-3.425020<td>3.53374<td>-6.37637<td>4.769799e-06<td>0.1340314<td>3.563774<tr><td>30156<td>-1.182569<td>-0.30486<td>-5.73847<td>1.785158e-05<td>0.3344196<td>2.463673<tr><td>34017<td>-1.562842<td>0.20193<td>-5.27569<td>4.798450e-05<td>0.6594008<td>1.480612<tr><td>9603<td>-1.070434<td>2.41423<td>-5.00915<td>8.571267e-05<td>0.6594008<td>0.751640<tr><td>53242<td>-1.591902<td>0.83988<td>-4.85549<td>1.201280e-04<td>0.6594008<td>0.657138<tr><td>51799<td>0.951387<td>-0.42095<td>4.74540<td>1.531894e-04<td>0.6594008<td>0.253207<tr><td>33526<td>0.951487<td>-0.42095<td>4.74485<td>1.533751e-04<td>0.6594008<td>0.251985<tr><td>17397<td>-0.950057<td>-0.42095<td>-4.74068<td>1.547968e-04<td>0.6594008<td>0.242677<tr><td>15000<td>-0.950611<td>-0.42095<td>-4.73765<td>1.558397e-04<td>0.6594008<td>0.235904</table></div><div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1"># Assuming results has columns like "logFC" (log fold change), "P.Value", and "adj.P.Val"</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="w">
	</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logFC</span><span class="p">,</span><span class="w">
	</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">log10</span><span class="p">(</span><span class="n">P.Value</span><span class="p">),</span><span class="w">
	</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adj.P.Val</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.05</span><span class="w">
</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"FALSE"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey"</span><span class="p">,</span><span class="w"> </span><span class="s2">"TRUE"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Log Fold Change"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"-log10 P-value"</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Volcano Plot of Differential Expression Results"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_minimal</span><span class="p">()</span><span class="w">

</span><span class="c1"># names(fit)</span><span class="w">
</span><span class="c1"># head(fit$coefficients)</span><span class="w">
</span><span class="c1"># head(fit$p.value)</span><span class="w">

</span><span class="c1"># Extract logFC, corresponding to your condition of interest (here assumed as "groupControl")</span><span class="w">
</span><span class="n">fit_results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">fit</span><span class="o">$</span><span class="n">coefficients</span><span class="p">)</span><span class="w">

</span><span class="c1"># Ensure the rows in tmp align with those in fit_results</span><span class="w">
</span><span class="n">fit_results</span><span class="o">$</span><span class="n">GeneDescription</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp</span><span class="o">$</span><span class="n">Description</span><span class="w">

</span><span class="n">fit_results</span><span class="o">$</span><span class="n">logFC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit_results</span><span class="p">[,</span><span class="w"> </span><span class="s2">"groupControl"</span><span class="p">]</span><span class="w">  </span><span class="c1"># Replace with the correct column name as per your design</span><span class="w">

</span><span class="c1"># Extract p-values and apply adjustment</span><span class="w">
</span><span class="n">fit_results</span><span class="o">$</span><span class="n">p_value</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">p.value</span><span class="p">[,</span><span class="w"> </span><span class="s2">"groupControl"</span><span class="p">]</span><span class="w">  </span><span class="c1"># Corresponding p-values</span><span class="w">
</span><span class="n">fit_results</span><span class="o">$</span><span class="n">adjPVal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p.adjust</span><span class="p">(</span><span class="n">fit_results</span><span class="o">$</span><span class="n">p_value</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BH"</span><span class="p">)</span><span class="w">  </span><span class="c1"># Adjust p-values</span><span class="w">


</span><span class="c1"># Enhanced analysis volcano plot ----</span><span class="w">

</span><span class="c1"># Extracting necessary data from the fit object</span><span class="w">
</span><span class="n">volcano_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">logFC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[,</span><span class="w"> </span><span class="s2">"groupControl"</span><span class="p">],</span><span class="w"> </span><span class="n">PValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">p.value</span><span class="p">[,</span><span class="w"> </span><span class="s2">"groupControl"</span><span class="p">])</span><span class="w">


</span><span class="c1"># Add gene descriptions from tmp to volcano_data</span><span class="w">
</span><span class="n">volcano_data</span><span class="o">$</span><span class="n">GeneDescription</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp</span><span class="o">$</span><span class="n">Description</span><span class="w">

</span><span class="n">EnhancedVolcano</span><span class="p">(</span><span class="w">
	</span><span class="n">volcano_data</span><span class="p">,</span><span class="w">
	</span><span class="n">lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">volcano_data</span><span class="o">$</span><span class="n">GeneDescription</span><span class="p">,</span><span class="w">
	</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'logFC'</span><span class="p">,</span><span class="w">
	</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'PValue'</span><span class="p">,</span><span class="w">
	</span><span class="n">pCutoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w">
	</span><span class="n">FCcutoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w">
	</span><span class="c1"># Adjust fold change cutoff as appropriate</span><span class="w">
	</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Volcano Plot'</span><span class="p">,</span><span class="w">
	</span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Differential Expression'</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># p_gtex_gene_median_tpm_volcano</span><span class="w">
</span><span class="c1"># 8x6 png</span><span class="w">
</span></code></pre></div></div><p><img src="/assets/images/acat/p_gtex_gene_median_tpm_volcano.png" width="50%" /></p><div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1"># FC weights ----</span><span class="w">
</span><span class="c1"># To convert the p-values from your differential expression analysis into weights scaled between 0 and 1, you can invert the p-values and then normalize them so that they sum up to 1. This approach assigns higher weights to genes with lower p-values (indicating higher significance), which aligns with your goal of giving more weight to genes more likely to be causal.</span><span class="w">

</span><span class="c1"># Apply negative log10 transformation</span><span class="w">
</span><span class="n">fit_results</span><span class="o">$</span><span class="n">NegLogPValue</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">-</span><span class="n">log10</span><span class="p">(</span><span class="n">fit_results</span><span class="o">$</span><span class="n">p_value</span><span class="p">)</span><span class="w">

</span><span class="c1"># Normalize the negative log p-values</span><span class="w">
</span><span class="n">fit_results</span><span class="o">$</span><span class="n">ScaledWeights</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit_results</span><span class="o">$</span><span class="n">NegLogPValue</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">fit_results</span><span class="o">$</span><span class="n">NegLogPValue</span><span class="p">)</span><span class="w">

</span><span class="c1"># Histogram of Scaled Weights</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">fit_results</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ScaledWeights</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span><span class="w">
								 </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w">
								 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Scaled Weights"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Frequency"</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Distribution of Scaled Weights"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_minimal</span><span class="p">()</span><span class="w">

</span><span class="c1"># p_gtex_gene_median_tpm_scaledweight</span><span class="w">
</span></code></pre></div></div><p><img src="/assets/images/acat/p_gtex_gene_median_tpm_scaledweight.png" width="80%" /></p><div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1"># Weights in ACAT ----</span><span class="w">
</span><span class="c1"># we want the top ten volcano_data$GeneDescription ranked on fit_results$ScaledWeights, which we can then use the top ten names from volcano_data$GeneDescription to pretend that they consist of 50 variants from the df variant_data_melted. the variant_data_melted$variants are numbered 1-50 so lets give 10 variants to each one volcano_data$GeneDescription (gene name).</span><span class="w">
</span><span class="c1"># we can then merge those two dataframes on GeneDescription.</span><span class="w">

</span><span class="c1"># Add ScaledWeights to volcano_data</span><span class="w">
</span><span class="n">volcano_data</span><span class="o">$</span><span class="n">ScaledWeights</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit_results</span><span class="o">$</span><span class="n">ScaledWeights</span><span class="p">[</span><span class="n">match</span><span class="p">(</span><span class="n">volcano_data</span><span class="o">$</span><span class="n">GeneDescription</span><span class="p">,</span><span class="w"> </span><span class="n">fit_results</span><span class="o">$</span><span class="n">GeneDescription</span><span class="p">)]</span><span class="w">

</span><span class="c1"># Rank and select the top 10 genes</span><span class="w">
</span><span class="n">top_genes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">volcano_data</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="o">-</span><span class="n">volcano_data</span><span class="o">$</span><span class="n">ScaledWeights</span><span class="p">),</span><span class="w"> </span><span class="s2">"GeneDescription"</span><span class="p">],</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">

</span><span class="c1"># Create a dataframe</span><span class="w">
</span><span class="n">variants_to_genes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
	</span><span class="n">GeneDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="n">top_genes</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w">
	</span><span class="n">variant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">top_genes</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Merge the dataframes</span><span class="w">
</span><span class="n">merged_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">volcano_data</span><span class="p">,</span><span class="w"> </span><span class="n">variants_to_genes</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GeneDescription"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Merge with variant_data_melted</span><span class="w">
</span><span class="n">variant_data_melted_gtex</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">merged_data</span><span class="p">,</span><span class="w"> </span><span class="n">variant_data_melted</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"variant"</span><span class="p">)</span><span class="w">

</span><span class="c1"># ACAT GTEx ----</span><span class="w">

</span><span class="c1"># Filter the data to include only P-values</span><span class="w">
</span><span class="n">p_values_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">variant_data_melted_gtex</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">filter</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"P-Value"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">mutate</span><span class="p">(</span><span class="n">log_p_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">log10</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w">

</span><span class="c1"># Group by variant and apply ACAT</span><span class="w">
</span><span class="n">p_values_per_variant</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p_values_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">group_by</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">summarize</span><span class="p">(</span><span class="n">aggregated_pval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ACAT</span><span class="p">(</span><span class="n">Pvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w">

</span><span class="n">p_values_per_variant_weight</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p_values_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">group_by</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">summarize</span><span class="p">(</span><span class="n">aggregated_pval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ACAT</span><span class="p">(</span><span class="n">Pvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ScaledWeights</span><span class="p">))</span><span class="w">

</span><span class="c1"># Test weights ----</span><span class="w">

</span><span class="c1"># Transform and scale p-values into weights</span><span class="w">
</span><span class="n">p_values_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p_values_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">mutate</span><span class="p">(</span><span class="w">
		</span><span class="n">LogWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">log10</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="w">
		</span><span class="n">ScaledWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">LogWeight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">LogWeight</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">LogWeight</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">LogWeight</span><span class="p">))</span><span class="w">
	</span><span class="p">)</span><span class="w">

</span><span class="c1"># Group by variant and apply ACAT with new ScaledWeights</span><span class="w">
</span><span class="n">p_values_per_variant_weight</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p_values_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">group_by</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">summarize</span><span class="p">(</span><span class="n">aggregated_pval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ACAT</span><span class="p">(</span><span class="n">Pvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ScaledWeight</span><span class="p">))</span><span class="w">

</span><span class="c1"># Prepare data for the first plot (without weights)</span><span class="w">
</span><span class="n">acat_results_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
	</span><span class="n">Variant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_values_per_variant</span><span class="o">$</span><span class="n">variant</span><span class="p">,</span><span class="w">
	</span><span class="n">ACAT_P_Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_values_per_variant</span><span class="o">$</span><span class="n">aggregated_pval</span><span class="p">,</span><span class="w">
	</span><span class="n">GTEx_DE_weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"unweighted"</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Prepare data for the second plot (with weights)</span><span class="w">
</span><span class="n">acat_results_df_weighted</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
	</span><span class="n">Variant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_values_per_variant_weight</span><span class="o">$</span><span class="n">variant</span><span class="p">,</span><span class="w">
	</span><span class="n">ACAT_P_Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_values_per_variant_weight</span><span class="o">$</span><span class="n">aggregated_pval</span><span class="p">,</span><span class="w">
	</span><span class="n">GTEx_DE_weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GTEx weighted"</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">acat_results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">acat_results_df</span><span class="p">,</span><span class="w"> </span><span class="n">acat_results_df_weighted</span><span class="p">)</span><span class="w">

</span><span class="n">p_acat_weight_GTEx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">acat_results</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
	</span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Variant</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">log10</span><span class="p">(</span><span class="n">ACAT_P_Value</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GTEx_DE_weight</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GTEx weight in ACAT"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"-log10(ACAT P-value)"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Variant"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">log10</span><span class="p">(</span><span class="n">significance_threshold</span><span class="p">)),</span><span class="w">
						 </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dashed"</span><span class="p">,</span><span class="w">
						 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w">

</span><span class="n">p_acat_weight_GTEx</span><span class="w">
</span><span class="c1"># Save the combined plot (optional)</span><span class="w">
</span><span class="c1"># ggsave("./images/p_acat_weight_GTEx_test.png", plot = p_acat_weight_GTEx)</span><span class="w">
</span></code></pre></div></div><p><img src="/assets/images/acat/p_acat_weight_GTEx_test.png" width="80%" /></p><hr><footer><div class="d-flex mt-2"></div></footer></div></div><div class="search-overlay"></div></div>
